class a{form;endpoint;submitBtn;buttonText;loadingSpinner;messageContainer;messageContent;constructor(e){this.form=e,this.endpoint=this.form.dataset.endpoint||"https://contact-form-worker.kalyana.workers.dev",this.submitBtn=this.form.querySelector(".submit-button"),this.buttonText=this.submitBtn.querySelector(".button-text"),this.loadingSpinner=this.submitBtn.querySelector(".loading-spinner"),this.messageContainer=this.form.parentElement?.querySelector(".form-message"),this.messageContent=this.messageContainer?.querySelector(".message-content"),this.init()}init(){this.form.addEventListener("submit",e=>this.handleSubmit(e)),this.addRealTimeValidation()}addRealTimeValidation(){this.form.querySelectorAll(".form-input, .form-select, .form-textarea").forEach(t=>{const s=t;s.addEventListener("blur",()=>this.validateField(s)),s.addEventListener("input",()=>this.clearFieldError(s))})}validateField(e){const t=e,s=t.name,i=t.value.trim(),r=this.form.querySelector(`[data-field="${s}"]`);return this.clearFieldError(e),t.hasAttribute("required")&&!i?(this.showFieldError(e,r,"This field is required"),!1):s==="email"&&i&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)?(this.showFieldError(e,r,"Please enter a valid email address"),!1):!0}showFieldError(e,t,s){e.classList.add("error"),t&&(t.textContent=s)}clearFieldError(e){e.classList.remove("error");const t=e,s=this.form.querySelector(`[data-field="${t.name}"]`);s&&(s.textContent="")}validateForm(){const e=this.form.querySelectorAll(".form-input, .form-select, .form-textarea");let t=!0;return e.forEach(s=>{const i=s;this.validateField(i)||(t=!1)}),t}async handleSubmit(e){if(e.preventDefault(),!this.validateForm()){this.showMessage("Please correct the errors above","error");return}this.setLoading(!0),this.hideMessage();const t=new FormData(this.form),s=Object.fromEntries(t.entries());try{const i=await fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await i.json();if(i.ok&&r.success)this.showMessage(r.message||"Thank you for your submission! We will contact you within 24 hours.","success"),this.form.reset(),document.dispatchEvent(new CustomEvent("contactFormSuccess",{detail:{data:s,result:r}}));else{const o=r.error||"Submission failed. Please try again.";r.missing&&r.missing.length>0?this.showMessage(`Missing required fields: ${r.missing.join(", ")}`,"error"):this.showMessage(o,"error"),document.dispatchEvent(new CustomEvent("contactFormError",{detail:{error:o}}))}}catch(i){console.error("Error submitting form:",i),this.showMessage("Network error. Please check your connection and try again.","error"),document.dispatchEvent(new CustomEvent("contactFormError",{detail:{error:i.message}}))}finally{this.setLoading(!1)}}setLoading(e){e?(this.submitBtn.disabled=!0,this.buttonText.style.display="none",this.loadingSpinner.style.display="inline-flex"):(this.submitBtn.disabled=!1,this.buttonText.style.display="inline",this.loadingSpinner.style.display="none")}showMessage(e,t){this.messageContent.textContent=e,this.messageContainer.className=`form-message ${t}`,this.messageContainer.style.display="block",t==="success"&&setTimeout(()=>this.hideMessage(),5e3)}hideMessage(){this.messageContainer.style.display="none",this.messageContent.textContent="",this.messageContainer.className="form-message"}}class l{wrapper;trigger;overlay;closeBtn;modal;constructor(e){this.wrapper=e,this.trigger=e.querySelector("[data-modal-trigger]"),this.overlay=e.querySelector("#contact-modal-overlay"),this.closeBtn=e.querySelector("[data-modal-close]"),this.modal=e.querySelector(".bg-white"),this.init()}init(){this.trigger.addEventListener("click",()=>this.open()),this.closeBtn.addEventListener("click",()=>this.close()),this.overlay.addEventListener("click",e=>{e.target===this.overlay&&this.close()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.overlay.classList.contains("active")&&this.close()}),document.addEventListener("contactFormSuccess",()=>{this.overlay.classList.contains("active")&&setTimeout(()=>this.close(),2e3)})}open(){this.overlay.classList.add("active"),this.trigger.setAttribute("aria-expanded","true"),document.body.style.overflow="hidden";const e=this.wrapper.querySelector("#modal-referrer");e&&(e.value=window.location.pathname+window.location.search),console.log("referrer field found:",e),console.log("referrer value:",e?.value);const t=this.modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');t.length>0&&t[0].focus()}close(){this.overlay.classList.remove("active"),this.trigger.setAttribute("aria-expanded","false"),document.body.style.overflow="",this.trigger.focus()}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".contact-modal-wrapper").forEach(e=>{new l(e);const t=e.querySelector(".contact-form-element");t&&new a(t)})});
